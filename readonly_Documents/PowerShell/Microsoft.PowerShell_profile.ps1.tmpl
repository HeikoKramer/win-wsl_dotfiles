# Generated by chezmoi from common/shortcuts.yml

$ErrorActionPreference = "Stop"
Set-Location $HOME
if (-not $env:DOTFILES) { $env:DOTFILES = "E:\Configs\dotfiles" }

# chezmoi environment-variable
try { $env:CHEZMOI_SOURCE_DIR = (chezmoi source-path) } catch {}

# Set default editors
function Edit-File {
  param([Parameter(Mandatory)] [string]$Path)
  $editor = $env:EDITOR
  if (-not $editor) {
    if (Get-Command code -ErrorAction SilentlyContinue)      { $editor = 'code' }
    elseif (Get-Command 'notepad++' -ErrorAction SilentlyContinue) { $editor = 'notepad++' }
    else                                                     { $editor = 'notepad' }
  }
  & $editor $Path
}

# --- Shortcuts aus YAML laden ---
$Shortcuts = @(
{{ $data := (include "common/shortcuts.yml" | fromYaml) }}
{{ range $data }}
    [pscustomobject]@{
        name = "{{ .name }}"
        cat  = "{{ .cat }}"
        desc = "{{ .desc }}"
        cmd  = {{- if and (hasKey .cmd "win")   (eq $.chezmoi.os "windows") -}} '{{ index .cmd "win" }}'
       {{- else if and (hasKey .cmd "linux") (eq $.chezmoi.os "linux")   -}} '{{ index .cmd "linux" }}'
       {{- else if hasKey .cmd "both" -}} '{{ index .cmd "both" }}'
       {{- else -}} '' {{- end }}
    };
{{ end }}
)

# --- Functions registrieren ---
foreach ($s in $Shortcuts) {
    if ([string]::IsNullOrWhiteSpace($s.cmd)) { continue }
    Set-Item -Path "function:$($s.name)" -Value ([scriptblock]::Create($s.cmd)) -Force
}

# --- Ãœbersicht: shortcuts [KAT] ---
function shortcuts {
    param([string]$Category)
    $Shortcuts
      | Where-Object { $_.cmd -and (!$Category -or $_.cat -eq $Category) }
      | Sort-Object cat,name
      | Select-Object name,cat,desc,cmd
      | Format-Table -AutoSize
}

try { Start-Service ssh-agent -ErrorAction SilentlyContinue | Out-Null } catch {}
Write-Host "Profile geladen. 'shortcuts' listet alles, 'shortcuts DIRS' filtert."
